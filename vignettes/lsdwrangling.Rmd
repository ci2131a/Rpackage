---
title: "lsdwrangling"
author: Charles Ingulli
date: June 21, 2020
version: 0.1
output: 
  html_document: default
  rmarkdown::html_vignette: default
vignette: >
  %\VignetteIndexEntry{lsdwrangling}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

The `lsdwrangling` package seeks to provide methods for transforming data to a different format. For example, statistical packages such as the `survival` package or `msm` package require their input data to be configured in different ways. In order to use the same data set in both packages, it is necessary to reconfigure the same information in two forms. The `lsdwrangling` package offers several functions that offer a seemless transition between one or more data formats. 

## Data Formats

The relevant data formats that are used in this package are described below. They include counting process data, right censored data, longitudinal data (panel data)

### Counting Process Data

One common data setup for survival analysis is the counting process format. This data is set up with two time variables and an event indicator. 


Let us consider a survival study of 3 individuals. Individuals are followed from the time of enrollment in the study until the event of interest occurs with monthly follow up visits. The initial visit will be referred to as the baseline where all individuals are assumed to be event free. At the monthly follow ups, individuals are tested to assess whether or not they have received the event. Time is then represented by intervals between visits with an associated event indicator variable. A visual depiction of the data is shown below in Table 1 where time is measured in days. 

```{r, echo = FALSE, results = "asis"}
data1 <- mydata <- data.frame(sid = c(1,1,1,2,2,3),
                     start = c(0,31,64,0,33,0),
                     stop = c(31,64,96,33,59,28),
                     status = c(0,0,1,0,0,1))
pander::pandoc.table(data1, style = "rmarkdown", caption = "Table 1: Counting Process Data")
```

The variable representation of each column is :

* **sid** - the individual's identification number.
* **start** - the left end point of the time interval.
* **stop** - the right end point of the time interval.
* **status** - the event indicator (0 denotes no event and 1 denotes having the event).

Each row of the data corresponds to a particular time interval for each individual. We can see in the first row that individual 1 started the study at time 0 and had a follow up visit 31 days later. At day 31, individual 1 is tested for the event and is determined to have not experienced the event. Time intervals are considered open on the left and closed on the right. That is, for times $t_1$ and $t_2$ where $t_1 < t_2$, the time interval is $(t_1, t_2]$. Looking at the third row, individual 1 starts a new time interval at day 64 and is seen for another follow up at day 126. At time 126, individual 1 is tested and is marked as experiencing the event.


Some data sets may also incorporate one or more explanatory variables. Often is the case in survival studies where other variables are measured that relate to the event of interest. These variables may be constant over time or may vary over time. Additionally, they may be qualitative variables or quantitative variables. Consider our previous example of 3 individuals. Let's say that in addition to measuring for the event of interest, individuals were also measured for age at baseline and the amount of medication they receive. The former can be considered a constant variable while the latter can be considered a time varying variable. An individual's age at baseline will not change but the amount of medication received by a patient in a survival study may change as the illness progresses. Both constant and time varying variables have a big effect on how the data set is organized as each row is used for a single time interval. 


The coding for new variables is:

* **age** - the numerical age of the individual in years at their baseline visit.
* **meds** - the level of medication received by an individual between visits (0 is for low, 1 is for medium, and 2 is for high).

In this example, age is a constant quantitative variable where as meds is a time varying qualitative variable. We create 3 levels for meds where individuals can be classified as receiving a low, medium, or high amount of medication.
Table 2 shows how these additional explanatory variables would be incorporated in counting process format.

```{r, echo = FALSE, results = "asis"}
data2 <- mydata <- data.frame(sid = c(1,1,1,2,2,3),
                     start = c(0,31,64,0,33,0),
                     stop = c(31,64,96,33,59,28),
                     status = c(0,0,1,0,0,1),
                     age = c(46,46,46,39,39,57),
                     meds = c(0,1,2,0,1,2)
                     )
pander::pandoc.table(data2, style = "rmarkdown", caption = "Table 2: Counting Process Data with Explanatory Variables")

```



The constant variables have the same interpretation at every time point. Individual 1 was measured to be 46 years at baseline and each subsequent visit individual 1 was still 46 years at baseline.


Time varying variables require a bit more interpretation. Even though the variables technically vary over time, they are considered to be constant between intervals. The intervals are still set up to be open on the left and closed on the right. Looking at individual 1 in Table 2, we can interpret the variables of the first row as the baseline visit. This means that at the baseline time of 0 this individual has a meds level of 0 corresponding to a low amount of medication received. At the first follow-up time of 31 the medication level is measured again and assigned a new value. However, because of the way the intervals are set up this value does not take effect until the next observation unit. Individual 1's complete meds values are 0 for $(0,31]$, 1 for $(31,64]$, and 2 for $(64,96]$. Even though the value of 1 was measured at time 31, it applies to the following interval.


<!-- Since the time intervals are considered open on the left and closed on the right, the value of the variable is observed at the right endpoint and stays constant ??? -->

### Right Censored Data

<!-- Since this study was solely concerned with survival time, the rows of follow up visits does not offer any additional insight to survival. -->
With the absence of time-dependent variables, the multiple rows of Table 1 do not provide additional information. A simplified form of the data is often used. This form is called right censored data? where each row corresponds to a single individual with their survival time. 

```{r, echo=FALSE, results = "asis"}
data3 <- mydata <- data.frame(sid = c(1,2,3),
                     time = c(96,33,28),
                     status = c(1,0,1))
pander::pandoc.table(data3, style = "rmarkdown", caption = "Table 3: Right Censored Data")
```

This form conveys the similar information as the previous. Within the time interval $(0, 96]$, individual 1 experiences the event. The data set shown in Table 2 is considered right censored data. The topic of censoring is outside the scope of this vignette but see (some sources) for more information. Additional simplifications are also possible. Since each individual starts at the same time point, in this example it is time of enrollment, the start variable can be ommitted. When each row corresponds to only one individual, some data sets may ommit the identification variable. 

### Longitudinal Data

The longitudinal data format is format used in repeated observation studies. It is also known as panel data and similarly panel studies. The respective terminologies are equivalent and refer to the same topics. 


## Application

The data formats described thus far are used for different statistical models. The counting process format is widely used in the `survival` package for implementing different proportional hazards models such as the Cox-proportional hazards model. The `flexsurv` package also uses this format and extends the `survival` package to add more flexible parametric proportional hazards models. The `msm` package uses the logitudinal data format to fit multi-state models. 

# Implementation









```{r setup}
#library(mypackage)
```








# References

Therune survival vignette
Ther book
Collett




